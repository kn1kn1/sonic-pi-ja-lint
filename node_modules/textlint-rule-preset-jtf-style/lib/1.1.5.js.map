{"version":3,"sources":["../src/1.1.5.js"],"names":[],"mappings":";AACA;;;;;;;;;;;;;;kBAUe,UAAU,OAAV,EAAmB;;;QACzB,SAAwC,QAAxC,OADyB;QACjB,YAAgC,QAAhC,UADiB;QACN,SAAqB,QAArB,OADM;QACE,YAAa,QAAb,UADF;;AAE9B,QAAI,eAAe,EAAf,CAF0B;AAG9B,QAAI,YAAY,EAAZ,CAH0B;;AAK9B,aAAS,UAAT,GAAsB;AAClB,uBAAe,EAAf,CADkB;AAElB,oBAAY,EAAZ,CAFkB;KAAtB;;AAKA,QAAM,kBAAkB,CAAlB;AAVwB,aAWrB,YAAT,CAAsB,IAAtB,QAA8C;YAAjB,yBAAiB;YAAR,mBAAQ;;AAC1C,aAAK,OAAL,CAAa,iBAAqB;gBAAnB,kBAAmB;gBAAb,wBAAa;;AAC9B,oBAAQ,OAAR,CAAgB,iBAAS;AACrB,oBAAI,gBAAJ,CADqB;AAErB,oBAAI,QAAJ,EAAc;AACV,oGAA6E,MAAM,KAAN,mBAA7E,CADU;iBAAd,MAEO,IAAI,KAAJ,EAAW;AACd,mGAA4E,MAAM,KAAN,oBAA5E,CADc;iBAAX;AAGP,uBAAO,IAAP,EAAa,IAAI,SAAJ,CAAc,OAAd,EAAuB;AAChC,0BAAM,MAAM,UAAN,GAAmB,CAAnB;AACN,4BAAQ,MAAM,WAAN,GAAoB,eAApB;iBAFC,CAAb,EAPqB;aAAT,CAAhB,CAD8B;SAArB,CAAb,CAD0C;KAA9C;;AAiBA,8CACK,OAAO,QAAP,EAAkB,oCAClB,OAAO,KAAP,YAAc,MAAK;AAChB,YAAI,OAAO,KAAK,GAAL;;AADK,YAGZ,SAAS,SAAT,IAAsB,SAAS,IAAT,EAAe;AACrC,mBADqC;SAAzC;AAGA,YAAI,cAAc,2CAAgB,IAAhB,CAAd,CANY;AAOhB,YAAI,YAAY,MAAZ,GAAqB,CAArB,EAAwB;AACxB,yBAAa,IAAb,CAAkB;AACd,sBAAM,IAAN;AACA,yBAAS,WAAT;aAFJ,EADwB;SAA5B;AAMA,YAAI,WAAW,wCAAa,IAAb,CAAX,CAbY;AAchB,YAAI,SAAS,MAAT,GAAkB,CAAlB,EAAqB;AACrB,sBAAU,IAAV,CAAe;AACX,sBAAM,IAAN;AACA,yBAAS,QAAT;aAFJ,EADqB;SAAzB;+BAOA,OAAO,QAAP,iCAAyB;AACzB,YAAI,gBAAgB,aAAa,MAAb,CAAoB,UAAC,KAAD;gBAAS;mBAAa,QAAQ,QAAQ,MAAR;SAA9B,EAA8C,CAAlE,CAAhB,CADqB;AAEzB,YAAI,aAAa,UAAU,MAAV,CAAiB,UAAC,KAAD;gBAAS;mBAAa,QAAQ,QAAQ,MAAR;SAA9B,EAA8C,CAA/D,CAAb,CAFqB;AAGzB,YAAI,kBAAkB,CAAlB,IAAuB,eAAe,CAAf,EAAkB;AACzC,mBADyC;SAA7C;AAGA,YAAI,gBAAgB,UAAhB,EAA4B;AAC5B,yBAAa,SAAb,EAAwB;AACpB,0BAAU,IAAV;aADJ,EAD4B;SAAhC,MAIO,IAAI,gBAAgB,UAAhB,EAA4B;AACnC,yBAAa,YAAb,EAA2B;AACvB,uBAAO,IAAP;aADJ,EADmC;SAAhC,MAIA;AACH,yBAAa,SAAb,EAAwB;AACpB,0BAAU,IAAV;aADJ,EADG;SAJA;aAjCf,CA5B8B;CAAnB;;AADf","file":"1.1.5.js","sourcesContent":["// LICENSE : MIT\n\"use strict\";\n/*\n1.1.5.図表のキャプション\n文章の内容に応じて、敬体、常体、体言止めを使います。\nいずれの場合も、複数の文体をできるだけ混在させないことが重要です。\n通常、文末に句点(。)を付けませんが、複数の文章になる場合は句点を使用します。\n\nキャプション間で文体が混ざっていないことを確認する。\n */\nimport {analyzeDesumasu, analyzeDearu} from \"analyze-desumasu-dearu\";\nexport default function (context) {\n    let {Syntax, RuleError, report, getSource} = context;\n    let desumasuList = [];\n    let dearuList = [];\n\n    function resetState() {\n        desumasuList = [];\n        dearuList = [];\n    }\n\n    const imagePaddingLet = 2;// ![ の分paddingを付ける\n    function reportResult(list, {desumasu,dearu}) {\n        list.forEach(({node, matches}) => {\n            matches.forEach(match => {\n                let message;\n                if (desumasu) {\n                    message = `図表のキャプションを敬体(ですます調)に統一して下さい。\\n図表のキャプション内で敬体、常体を混在させないことが重要です。\\n\"${match.value}\"が常体(である調)です。`\n                } else if (dearu) {\n                    message = `図表のキャプションを常体(である調)に統一して下さい。\\n図表のキャプション内で敬体、常体を混在させないことが重要です。\\n\"${match.value}\"が敬体(ですます調)です。`\n                }\n                report(node, new RuleError(message, {\n                    line: match.lineNumber - 1,\n                    column: match.columnIndex + imagePaddingLet\n                }));\n            });\n        });\n    }\n\n    return {\n        [Syntax.Document]: resetState,\n        [Syntax.Image](node){\n            let text = node.alt;\n            // alt がない場合は無視する\n            if (text === undefined || text === null) {\n                return;\n            }\n            let retDesumasu = analyzeDesumasu(text);\n            if (retDesumasu.length > 0) {\n                desumasuList.push({\n                    node: node,\n                    matches: retDesumasu\n                });\n            }\n            let retDearu = analyzeDearu(text);\n            if (retDearu.length > 0) {\n                dearuList.push({\n                    node: node,\n                    matches: retDearu\n                });\n            }\n        },\n        [`${Syntax.Document}:exit`](){\n            let desumasuCount = desumasuList.reduce((count, {matches}) => count + matches.length, 0);\n            let dearuCount = dearuList.reduce((count, {matches}) => count + matches.length, 0);\n            if (desumasuCount === 0 || dearuCount === 0) {\n                return;\n            }\n            if (desumasuCount > dearuCount) {\n                reportResult(dearuList, {\n                    desumasu: true\n                });\n            } else if (desumasuCount < dearuCount) {\n                reportResult(desumasuList, {\n                    dearu: true\n                });\n            } else {\n                reportResult(dearuList, {\n                    desumasu: true\n                });\n            }\n        }\n    }\n}"]}